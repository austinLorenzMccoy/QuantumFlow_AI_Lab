
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKX Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #2a2a2a;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
        }
        .connection-status {
            display: flex;
            align-items: center;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .connected {
            background-color: #4CAF50;
        }
        .disconnected {
            background-color: #F44336;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-card {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        .price-info {
            text-align: right;
        }
        .current-price {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
        }
        .price-change {
            margin: 5px 0 0 0;
            font-size: 14px;
        }
        .positive {
            color: #4CAF50;
        }
        .negative {
            color: #F44336;
        }
        .signals-container {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
        }
        .signals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .signals-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        .signals-table {
            width: 100%;
            border-collapse: collapse;
        }
        .signals-table th, .signals-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .signals-table th {
            background-color: #f2f2f2;
        }
        .buy-signal {
            color: #4CAF50;
            font-weight: bold;
        }
        .sell-signal {
            color: #F44336;
            font-weight: bold;
        }
        .chart-container {
            position: relative;
            height: 250px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OKX Trading Dashboard</h1>
            <div class="connection-status">
                <div id="status-indicator" class="status-indicator disconnected"></div>
                <span id="connection-status">Disconnected</span>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart-card">
                <div class="chart-header">
                    <h2 class="chart-title">BTC-USDT</h2>
                    <div class="price-info">
                        <p id="btc-price" class="current-price">$0.00</p>
                        <p id="btc-change" class="price-change">0.00%</p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="btc-chart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h2 class="chart-title">ETH-USDT</h2>
                    <div class="price-info">
                        <p id="eth-price" class="current-price">$0.00</p>
                        <p id="eth-change" class="price-change">0.00%</p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="eth-chart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h2 class="chart-title">SOL-USDT</h2>
                    <div class="price-info">
                        <p id="sol-price" class="current-price">$0.00</p>
                        <p id="sol-change" class="price-change">0.00%</p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="sol-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="signals-container">
            <div class="signals-header">
                <h2 class="signals-title">Trading Signals</h2>
            </div>
            <table class="signals-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Symbol</th>
                        <th>Price</th>
                        <th>Signal</th>
                    </tr>
                </thead>
                <tbody id="signals-body">
                    <!-- Signals will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // WebSocket connection
        let socket;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        const reconnectDelay = 3000; // 3 seconds
        
        // Chart objects
        const charts = {};
        const priceData = {
            'BTC-USDT': [],
            'ETH-USDT': [],
            'SOL-USDT': []
        };
        
        // Previous prices for calculating change
        const previousPrices = {
            'BTC-USDT': 0,
            'ETH-USDT': 0,
            'SOL-USDT': 0
        };
        
        // Initialize charts
        function initCharts() {
            const symbols = ['BTC-USDT', 'ETH-USDT', 'SOL-USDT'];
            const colors = {
                'BTC-USDT': 'rgb(247, 147, 26)',
                'ETH-USDT': 'rgb(98, 126, 234)',
                'SOL-USDT': 'rgb(20, 241, 149)'
            };
            
            symbols.forEach(symbol => {
                const shortSymbol = symbol.split('-')[0].toLowerCase();
                const ctx = document.getElementById(`${shortSymbol}-chart`).getContext('2d');
                
                charts[symbol] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: symbol,
                            data: [],
                            borderColor: colors[symbol],
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.1,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: false
                                },
                                ticks: {
                                    maxTicksLimit: 5
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        animation: {
                            duration: 0
                        }
                    }
                });
            });
        }
        
        // Update chart with new price data
        function updateChart(symbol, price, timestamp) {
            if (!charts[symbol]) return;
            
            const time = new Date(timestamp * 1000).toLocaleTimeString();
            const chart = charts[symbol];
            
            // Add new data point
            chart.data.labels.push(time);
            chart.data.datasets[0].data.push(price);
            
            // Keep only the last 30 data points
            if (chart.data.labels.length > 30) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }
            
            // Update the chart
            chart.update();
            
            // Update price display
            const shortSymbol = symbol.split('-')[0].toLowerCase();
            const priceElement = document.getElementById(`${shortSymbol}-price`);
            const changeElement = document.getElementById(`${shortSymbol}-change`);
            
            priceElement.textContent = `$${price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            
            // Calculate and display price change
            if (previousPrices[symbol] > 0) {
                const change = ((price - previousPrices[symbol]) / previousPrices[symbol]) * 100;
                const changeText = change.toFixed(2) + '%';
                
                changeElement.textContent = changeText;
                if (change >= 0) {
                    changeElement.className = 'price-change positive';
                    changeElement.textContent = '+' + changeText;
                } else {
                    changeElement.className = 'price-change negative';
                }
            }
            
            // Update previous price
            previousPrices[symbol] = price;
        }
        
        // Add a new trading signal to the table
        function addSignal(signal) {
            const signalsBody = document.getElementById('signals-body');
            const row = document.createElement('tr');
            
            // Format the timestamp
            const time = new Date(signal.timestamp).toLocaleTimeString();
            
            // Create the signal row
            row.innerHTML = `
                <td>${time}</td>
                <td>${signal.symbol}</td>
                <td>$${signal.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                <td class="${signal.signal.toLowerCase()}-signal">${signal.signal}</td>
            `;
            
            // Add the row to the table
            signalsBody.prepend(row);
            
            // Keep only the last 10 signals
            while (signalsBody.children.length > 10) {
                signalsBody.removeChild(signalsBody.lastChild);
            }
        }
        
        // Connect to the WebSocket server
        function connectWebSocket() {
            // Update connection status
            const statusIndicator = document.getElementById('status-indicator');
            const connectionStatus = document.getElementById('connection-status');
            statusIndicator.className = 'status-indicator disconnected';
            connectionStatus.textContent = 'Connecting...';
            
            // Create WebSocket connection
            socket = new WebSocket('ws://localhost:8765');
            
            // Connection opened
            socket.addEventListener('open', (event) => {
                console.log('Connected to WebSocket server');
                statusIndicator.className = 'status-indicator connected';
                connectionStatus.textContent = 'Connected';
                reconnectAttempts = 0;
                
                // Subscribe to updates
                socket.send(JSON.stringify({ action: 'subscribe' }));
            });
            
            // Listen for messages
            socket.addEventListener('message', (event) => {
                try {
                    const message = JSON.parse(event.data);
                    
                    if (message.type === 'price_update') {
                        // Update chart with new price data
                        updateChart(message.symbol, message.data.price, message.data.timestamp);
                    } else if (message.type === 'price_history') {
                        // Initialize chart with historical data
                        message.data.forEach(item => {
                            updateChart(message.symbol, item.price, item.timestamp);
                        });
                    } else if (message.type === 'trading_signal') {
                        // Add trading signal
                        addSignal(message.data);
                    } else if (message.type === 'trading_signals') {
                        // Add multiple trading signals
                        message.data.forEach(signal => {
                            addSignal(signal);
                        });
                    }
                } catch (error) {
                    console.error('Error processing message:', error);
                }
            });
            
            // Connection closed
            socket.addEventListener('close', (event) => {
                console.log('Disconnected from WebSocket server');
                statusIndicator.className = 'status-indicator disconnected';
                connectionStatus.textContent = 'Disconnected';
                
                // Attempt to reconnect
                if (reconnectAttempts < maxReconnectAttempts) {
                    reconnectAttempts++;
                    console.log(`Reconnecting (${reconnectAttempts}/${maxReconnectAttempts})...`);
                    setTimeout(connectWebSocket, reconnectDelay);
                } else {
                    console.log('Max reconnect attempts reached');
                    connectionStatus.textContent = 'Disconnected (Max attempts reached)';
                }
            });
            
            // Connection error
            socket.addEventListener('error', (event) => {
                console.error('WebSocket error:', event);
            });
        }
        
        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            connectWebSocket();
        });
    </script>
</body>
</html>
    